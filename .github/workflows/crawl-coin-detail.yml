name: Crawl Coin Detail Hourly

on:
  workflow_dispatch:        # ğŸ§  Cho phÃ©p cháº¡y thá»§ cÃ´ng tá»« GitHub UI
  push:                     # ğŸš€ Tá»± Ä‘á»™ng cháº¡y khi file crawl_coin_detail.js thay Ä‘á»•i
    paths:
      - 'crawl_coin_detail.js'
  schedule:                 # â° Tá»± Ä‘á»™ng cháº¡y má»—i giá» má»™t láº§n (vÃ o phÃºt 0)
    - cron: '0 * * * *'

jobs:
  crawl:
    runs-on: ubuntu-latest  # ğŸ–¥ï¸ DÃ¹ng mÃ¡y áº£o Ubuntu má»›i nháº¥t Ä‘á»ƒ cháº¡y job

    steps:
      - name: ğŸ§¾ Checkout code
        uses: actions/checkout@v4  # Láº¥y code tá»« repository

      - name: ğŸ”„ Pull latest changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git pull origin main || true  # LuÃ´n pull code má»›i Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t khi push

      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18  # DÃ¹ng Node.js version 18

      # - name: ğŸ“¦ Install dependencies
      #   run: npm install  # CÃ i cÃ¡c package tá»« package.json (náº¿u cÃ³)

      - name: ğŸš€ Run crawl script
        run: node crawl_coin_detail.js
        continue-on-error: true  # âš ï¸ DÃ¹ lá»—i váº«n tiáº¿p tá»¥c job

      - name: ğŸ’¾ Commit updated coin details
        if: always()  # ğŸ” LuÃ´n cháº¡y dÃ¹ cÃ³ lá»—i á»Ÿ bÆ°á»›c trÆ°á»›c
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git pull origin main --rebase || true  # KÃ©o code má»›i nháº¥t Ä‘á»ƒ giáº£m xung Ä‘á»™t
          git add coin/detail/
          git diff --cached --quiet || git commit -m "ğŸª™ Update coin details $(date +'%Y-%m-%d %H:%M')"
          git push
